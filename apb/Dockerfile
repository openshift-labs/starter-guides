FROM ansibleplaybookbundle/apb-base:release-1.3

LABEL "com.redhat.apb.spec"=\
"dmVyc2lvbjogJzEuMC4wJwpuYW1lOiBzdGFydGVyLXdvcmtzaG9wLWFwYgpkZXNjcmlwdGlvbjog\
QVBCIHRvIGRlcGxveSByZXF1aXJlZCBpbmZyYSBjb21wb25lbnRzIGZvciB0aGUgRGV2ZWxvcGVy\
IFN0YXJ0ZXIgV29ya3Nob3Agb24gYW4gT3BlblNoaWZ0IGNsdXN0ZXIKYmluZGFibGU6IEZhbHNl\
CmFzeW5jOiBvcHRpb25hbAp0YWdzOgotIHdvcmtzaG9wCm1ldGFkYXRhOgogIGRlcGVuZGVuY2ll\
czogWydkb2NrZXIuaW8vb3Nldmcvd29ya3Nob3BwZXI6bGF0ZXN0JywnZG9ja2VyLmlvL29wZW5z\
aGlmdGRlbW9zL2dvZ3M6MC4xMS4zNCcsJ3F1YXkuaW8vd2t1bGhhbmVrL2V0aGVycGFkOjEuNi41\
JywnZG9ja2VyLmlvL3NvbmF0eXBlL25leHVzMzozLjExLjAnLCAnZG9ja2VyLmlvL3JhZmZhZWxl\
c3BhenpvbGkvb2NwLW9wcy12aWV3OmxhdGVzdCddCiAgZGlzcGxheU5hbWU6ICJPcGVuU2hpZnQg\
RGV2ZWxvcGVyIFN0YXJ0ZXIgV29ya3Nob3AgSW5zdGFsbGVyIgogIGxvbmdEZXNjcmlwdGlvbjog\
fC0KICAgIEluc3RhbGxzIHRoZSBsYWIgaW5zdHJ1Y3Rpb25zIGFuZCByZXF1aXJlZCBjb21wb25l\
bnRzCiAgICAtIEdvZ3Mgc2VydmVyCiAgICAtIE5leHVzCiAgICAtIEV0aGVycGFkCiAgICAtIExh\
YiBHdWlkZXMKICAgIC0gT0NQLU9wc1ZpZXcgKGltYWdlIGJ5IFJhZmZhZWxlIFNwYXp6b2xpKQog\
ICAgZm9yIHJ1bm5pbmcgdGhlIEdldHRpbmcgc3RhcnRlciBkZXZlbG9waW5nIG9uIE9wZW5TaGlm\
dCBXb3Jrc2hvcCBodHRwczovL2dpdGh1Yi5jb20vb3BlbnNoaWZ0LWxhYnMvc3RhcnRlci1ndWlk\
ZXMKICBjb25zb2xlLm9wZW5zaGlmdC5pby9pY29uQ2xhc3M6ICJwZmljb24gcGZpY29uLXByb2Nl\
c3MtYXV0b21hdGlvbiIKICBwcm92aWRlckRpc3BsYXlOYW1lOiAiUmVkIEhhdCwgSW5jLiIKcGxh\
bnM6CiAgLSBuYW1lOiBkZWZhdWx0CiAgICBkZXNjcmlwdGlvbjogRGVwbG95cyBPcGVuU2hpZnQg\
U3RhcnRlciBXb3Jrc2hvcCBJbmZyYXN0cnVjdHVyZQogICAgZnJlZTogVHJ1ZQogICAgbWV0YWRh\
dGE6CiAgICAgIGRpc3BsYXlOYW1lOiBEZWZhdWx0CiAgICBwYXJhbWV0ZXJzOgogICAgLSBuYW1l\
OiBvcGVuc2hpZnRfdXNlcgogICAgICB0aXRsZTogVXNlcm5hbWUKICAgICAgZGVzY3JpcHRpb246\
IFVzZXIgaXMgcmVxdWlyZWQgZm9yIGNyZWF0aW5nIHByb2plY3QgYWRtaW4gcmVzb3VyY2VzCiAg\
ICAgIHR5cGU6IHN0cmluZwogICAgICByZXF1aXJlZDogdHJ1ZQogICAgICBkaXNwbGF5X3R5cGU6\
IHRleHQKICAgICAgZGlzcGxheV9ncm91cDogT3BlblNoaWZ0IFVzZXIKICAgIC0gbmFtZTogb3Bl\
bnNoaWZ0X3Bhc3N3b3JkCiAgICAgIHRpdGxlOiBQYXNzd29yZAogICAgICBkZXNjcmlwdGlvbjog\
UGFzc3dvcmQgaXMgcmVxdWlyZWQgZm9yIGNyZWF0aW5nIHByb2plY3QgYWRtaW4gcmVzb3VyY2Vz\
CiAgICAgIHR5cGU6IHN0cmluZwogICAgICByZXF1aXJlZDogdHJ1ZQogICAgICBkaXNwbGF5X3R5\
cGU6IHBhc3N3b3JkCiAgICAgIGRpc3BsYXlfZ3JvdXA6IE9wZW5TaGlmdCBVc2VyCiAgICAtIG5h\
bWU6IHdvcmtzaG9wX3R5cGUKICAgICAgdGl0bGU6IFdvcmtzaG9wIHR5cGUKICAgICAgZGVzY3Jp\
cHRpb246IFR5cGUgb2Ygd29ya3Nob3AgdG8gZGVsaXZlciAoSmF2YSwgUHl0aG9uLCBub2RlLmpz\
KQogICAgICB0eXBlOiBlbnVtCiAgICAgIGVudW06IFsnamF2YScsICdweXRob24nLCAnbm9kZS5q\
cycsICdwaHAnXQogICAgICByZXF1aXJlZDogdHJ1ZQogICAgICBkaXNwbGF5X3R5cGU6IHNlbGVj\
dAogICAgICBkZWZhdWx0OiBqYXZhCiAgICAgIGRpc3BsYXlfZ3JvdXA6IFdvcmtzaG9wCiAgICAt\
IG5hbWU6IHVzZXJfY291bnQKICAgICAgdGl0bGU6IE51bWJlciBvZiBwYXJ0aWNpcGFudHMKICAg\
ICAgZGVzY3JpcHRpb246IE51bWJlciBvZiBwYXJ0aWNpcGFudHMgZm9yIHRoZSB3b3Jrc2hvcC4g\
VGhlcmUgd2lsbCBiZSBwcm92aXNpb25lZCBpbmZyYXN0cnVjdHVyZS9wcm9qZWN0IGZvciBlYWNo\
IHBhcnRpY2lwYW50CiAgICAgIHR5cGU6IG51bWJlcgogICAgICByZXF1aXJlZDogdHJ1ZQogICAg\
ICBkaXNwbGF5X2dyb3VwOiBXb3Jrc2hvcAogICAgLSBuYW1lOiBvcGVuc2hpZnRfdXNlcl9wYXNz\
d29yZAogICAgICB0aXRsZTogT3BlblNoaWZ0IFVzZXIgUGFzc3dvcmQKICAgICAgZGVzY3JpcHRp\
b246IFRoZSBPcGVuU2hpZnQgcGFzc3dvcmQgZm9yIHBhcnRpY2lwYW50cyB0byBiZSBkaXNwbGF5\
ZWQgaW4gdGhlIGxhYiBndWlkZSB0byBwYXJ0aWNpcGFudHMKICAgICAgdHlwZTogc3RyaW5nCiAg\
ICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgIGRpc3BsYXlfdHlwZTogdGV4dAogICAgICBkaXNwbGF5\
X2dyb3VwOiBXb3Jrc2hvcAogICAgLSBuYW1lOiBvcGVuc2hpZnRfbWFzdGVyX3VybAogICAgICB0\
aXRsZTogT3BlblNoaWZ0IE1hc3RlciBVUkwKICAgICAgZGVzY3JpcHRpb246IFRoZSBhZGRyZXNz\
IHRvIE9wZW5TaGlmdCBtYXN0ZXIgVVJMIHRvIGJlIGRpc3BsYXllZCBpbiB0aGUgbGFiIGd1aWRl\
IHRvIHBhcnRpY2lwYW50cwogICAgICB0eXBlOiBzdHJpbmcKICAgICAgcmVxdWlyZWQ6IHRydWUK\
ICAgICAgZGlzcGxheV90eXBlOiB0ZXh0CiAgICAgIGRpc3BsYXlfZ3JvdXA6IExhYiBHdWlkZQog\
ICAgLSBuYW1lOiBpbmZyYXN2Y3NfYWRtX3VzZXIKICAgICAgdGl0bGU6IEluZnJhc3RydWN0dXJl\
IFNlcnZpY2VzIEFkbWluIFVzZXIKICAgICAgZGVzY3JpcHRpb246IEFkbWluIHVzZXIgZm9yIGlu\
ZnJhc3RydWN0dXJlIHNlcnZpY2VzIChHb2dzLCBOZXh1cywgLi4uKQogICAgICB0eXBlOiBzdHJp\
bmcKICAgICAgZGVmYXVsdDogImFkbWludXNlciIKICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAg\
ZGlzcGxheV90eXBlOiB0ZXh0CiAgICAgIGRpc3BsYXlfZ3JvdXA6IEluZnJhc3RydWN0dXJlIFNl\
cnZpY2VzCiAgICAtIG5hbWU6IGluZnJhc3Zjc19hZG1fcGFzc3dvcmQKICAgICAgdGl0bGU6IElu\
ZnJhc3RydWN0dXJlIFNlcnZpY2VzIEFkbWluIFBhc3N3b3JkCiAgICAgIGRlc2NyaXB0aW9uOiBB\
ZG1pbiBwYXNzd29yZCBmb3IgaW5mcmFzdHJ1Y3R1cmUgc2VydmljZXMgKEdvZ3MsIE5leHVzLCAu\
Li4pCiAgICAgIHR5cGU6IHN0cmluZwogICAgICBkZWZhdWx0OiAiYWRtaW4xMjMiCiAgICAgIHJl\
cXVpcmVkOiB0cnVlCiAgICAgIGRpc3BsYXlfdHlwZTogdGV4dAogICAgICBkaXNwbGF5X2dyb3Vw\
OiBJbmZyYXN0cnVjdHVyZSBTZXJ2aWNlcwo="

COPY playbooks /opt/apb/actions
COPY roles /opt/ansible/roles
ADD requirements.yml /opt/apb/actions/requirements.yml
RUN ansible-galaxy install -r /opt/apb/actions/requirements.yml -f
RUN chmod -R g=u /opt/{ansible,apb}
USER apb

ENV BUNDLE_DEBUG=true
