FROM ansibleplaybookbundle/apb-base:release-1.3

LABEL "com.redhat.apb.spec"=\
"dmVyc2lvbjogJzEuMC4wJwpuYW1lOiBzdGFydGVyLXdvcmtzaG9wLWFwYgpkZXNjcmlwdGlvbjog\
QVBCIHRvIGRlcGxveSByZXF1aXJlZCBpbmZyYSBjb21wb25lbnRzIGZvciB0aGUgRGV2ZWxvcGVy\
IFN0YXJ0ZXIgV29ya3Nob3Agb24gYW4gT3BlblNoaWZ0IGNsdXN0ZXIKYmluZGFibGU6IEZhbHNl\
CmFzeW5jOiBvcHRpb25hbAp0YWdzOgotIHdvcmtzaG9wCm1ldGFkYXRhOgogIGRlcGVuZGVuY2ll\
czogWydkb2NrZXIuaW8vb3Nldmcvd29ya3Nob3BwZXI6bGF0ZXN0JywnZG9ja2VyLmlvL29wZW5z\
aGlmdGRlbW9zL2dvZ3M6MC4xMS4zNCcsJ3F1YXkuaW8vd2t1bGhhbmVrL2V0aGVycGFkOjEuNi41\
JywnZG9ja2VyLmlvL3NvbmF0eXBlL25leHVzMzozLjExLjAnLCAnZG9ja2VyLmlvL2VjbGlwc2Uv\
Y2hlLXNlcnZlcjozLjcuMScsICdkb2NrZXIuaW8vcmFmZmFlbGVzcGF6em9saS9vY3Atb3BzLXZp\
ZXc6bGF0ZXN0J10KICBkaXNwbGF5TmFtZTogIk9wZW5TaGlmdCBEZXZlbG9wZXIgU3RhcnRlciBX\
b3Jrc2hvcCBJbnN0YWxsZXIiCiAgbG9uZ0Rlc2NyaXB0aW9uOiB8LQogICAgSW5zdGFsbHMgdGhl\
IGxhYiBpbnN0cnVjdGlvbnMgYW5kIHJlcXVpcmVkIGNvbXBvbmVudHMKICAgIC0gR29ncyBzZXJ2\
ZXIKICAgIC0gTmV4dXMKICAgIC0gRXRoZXJwYWQKICAgIC0gTGFiIEd1aWRlcwogICAgLSBFY2xp\
cHNlIENoZQogICAgLSBPQ1AtT3BzVmlldyAoaW1hZ2UgYnkgUmFmZmFlbGUgU3BhenpvbGkpCiAg\
ICBmb3IgcnVubmluZyB0aGUgR2V0dGluZyBzdGFydGVyIGRldmVsb3Bpbmcgb24gT3BlblNoaWZ0\
IFdvcmtzaG9wIGh0dHBzOi8vZ2l0aHViLmNvbS9vcGVuc2hpZnQtbGFicy9zdGFydGVyLWd1aWRl\
cwogIGNvbnNvbGUub3BlbnNoaWZ0LmlvL2ljb25DbGFzczogInBmaWNvbiBwZmljb24tcHJvY2Vz\
cy1hdXRvbWF0aW9uIgogIHByb3ZpZGVyRGlzcGxheU5hbWU6ICJSZWQgSGF0LCBJbmMuIgpwbGFu\
czoKICAtIG5hbWU6IGRlZmF1bHQKICAgIGRlc2NyaXB0aW9uOiBEZXBsb3lzIE9wZW5TaGlmdCBT\
dGFydGVyIFdvcmtzaG9wIEluZnJhc3RydWN0dXJlCiAgICBmcmVlOiBUcnVlCiAgICBtZXRhZGF0\
YToKICAgICAgZGlzcGxheU5hbWU6IERlZmF1bHQKICAgIHBhcmFtZXRlcnM6CiAgICAtIG5hbWU6\
IG9wZW5zaGlmdF91c2VyCiAgICAgIHRpdGxlOiBVc2VybmFtZQogICAgICBkZXNjcmlwdGlvbjog\
VXNlciBpcyByZXF1aXJlZCBmb3IgY3JlYXRpbmcgcHJvamVjdCBhZG1pbiByZXNvdXJjZXMKICAg\
ICAgdHlwZTogc3RyaW5nCiAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgIGRpc3BsYXlfdHlwZTog\
dGV4dAogICAgICBkaXNwbGF5X2dyb3VwOiBPcGVuU2hpZnQgVXNlcgogICAgLSBuYW1lOiBvcGVu\
c2hpZnRfcGFzc3dvcmQKICAgICAgdGl0bGU6IFBhc3N3b3JkCiAgICAgIGRlc2NyaXB0aW9uOiBQ\
YXNzd29yZCBpcyByZXF1aXJlZCBmb3IgY3JlYXRpbmcgcHJvamVjdCBhZG1pbiByZXNvdXJjZXMK\
ICAgICAgdHlwZTogc3RyaW5nCiAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgIGRpc3BsYXlfdHlw\
ZTogcGFzc3dvcmQKICAgICAgZGlzcGxheV9ncm91cDogT3BlblNoaWZ0IFVzZXIKICAgIC0gbmFt\
ZTogd29ya3Nob3BfdHlwZQogICAgICB0aXRsZTogV29ya3Nob3AgdHlwZQogICAgICBkZXNjcmlw\
dGlvbjogVHlwZSBvZiB3b3Jrc2hvcCB0byBkZWxpdmVyIChKYXZhLCBQeXRob24sIG5vZGUuanMp\
CiAgICAgIHR5cGU6IGVudW0KICAgICAgZW51bTogWydqYXZhJywgJ3B5dGhvbicsICdub2RlLmpz\
JywgJ3BocCddCiAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgIGRpc3BsYXlfdHlwZTogc2VsZWN0\
CiAgICAgIGRlZmF1bHQ6IGphdmEKICAgICAgZGlzcGxheV9ncm91cDogV29ya3Nob3AKICAgIC0g\
bmFtZTogdXNlcl9jb3VudAogICAgICB0aXRsZTogTnVtYmVyIG9mIHBhcnRpY2lwYW50cwogICAg\
ICBkZXNjcmlwdGlvbjogTnVtYmVyIG9mIHBhcnRpY2lwYW50cyBmb3IgdGhlIHdvcmtzaG9wLiBU\
aGVyZSB3aWxsIGJlIHByb3Zpc2lvbmVkIGluZnJhc3RydWN0dXJlL3Byb2plY3QgZm9yIGVhY2gg\
cGFydGljaXBhbnQKICAgICAgdHlwZTogbnVtYmVyCiAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAg\
IGRpc3BsYXlfZ3JvdXA6IFdvcmtzaG9wCiAgICAtIG5hbWU6IG9wZW5zaGlmdF91c2VyX3Bhc3N3\
b3JkCiAgICAgIHRpdGxlOiBPcGVuU2hpZnQgVXNlciBQYXNzd29yZAogICAgICBkZXNjcmlwdGlv\
bjogVGhlIE9wZW5TaGlmdCBwYXNzd29yZCBmb3IgcGFydGljaXBhbnRzIHRvIGJlIGRpc3BsYXll\
ZCBpbiB0aGUgbGFiIGd1aWRlIHRvIHBhcnRpY2lwYW50cwogICAgICB0eXBlOiBzdHJpbmcKICAg\
ICAgcmVxdWlyZWQ6IHRydWUKICAgICAgZGlzcGxheV90eXBlOiB0ZXh0CiAgICAgIGRpc3BsYXlf\
Z3JvdXA6IFdvcmtzaG9wCiAgICAtIG5hbWU6IG9wZW5zaGlmdF9tYXN0ZXJfdXJsCiAgICAgIHRp\
dGxlOiBPcGVuU2hpZnQgTWFzdGVyIFVSTAogICAgICBkZXNjcmlwdGlvbjogVGhlIGFkZHJlc3Mg\
dG8gT3BlblNoaWZ0IG1hc3RlciBVUkwgdG8gYmUgZGlzcGxheWVkIGluIHRoZSBsYWIgZ3VpZGUg\
dG8gcGFydGljaXBhbnRzCiAgICAgIHR5cGU6IHN0cmluZwogICAgICByZXF1aXJlZDogdHJ1ZQog\
ICAgICBkaXNwbGF5X3R5cGU6IHRleHQKICAgICAgZGlzcGxheV9ncm91cDogTGFiIEd1aWRlCiAg\
ICAtIG5hbWU6IGluZnJhc3Zjc19hZG1fdXNlcgogICAgICB0aXRsZTogSW5mcmFzdHJ1Y3R1cmUg\
U2VydmljZXMgQWRtaW4gVXNlcgogICAgICBkZXNjcmlwdGlvbjogQWRtaW4gdXNlciBmb3IgaW5m\
cmFzdHJ1Y3R1cmUgc2VydmljZXMgKEdvZ3MsIENoZSwgLi4uKQogICAgICB0eXBlOiBzdHJpbmcK\
ICAgICAgZGVmYXVsdDogImFkbWludXNlciIKICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgZGlz\
cGxheV90eXBlOiB0ZXh0CiAgICAgIGRpc3BsYXlfZ3JvdXA6IEluZnJhc3RydWN0dXJlIFNlcnZp\
Y2VzCiAgICAtIG5hbWU6IGluZnJhc3Zjc19hZG1fcGFzc3dvcmQKICAgICAgdGl0bGU6IEluZnJh\
c3RydWN0dXJlIFNlcnZpY2VzIEFkbWluIFBhc3N3b3JkCiAgICAgIGRlc2NyaXB0aW9uOiBBZG1p\
biBwYXNzd29yZCBmb3IgaW5mcmFzdHJ1Y3R1cmUgc2VydmljZXMgKEdvZ3MsIENoZSwgLi4uKQog\
ICAgICB0eXBlOiBzdHJpbmcKICAgICAgZGVmYXVsdDogImFkbWluMTIzIgogICAgICByZXF1aXJl\
ZDogdHJ1ZQogICAgICBkaXNwbGF5X3R5cGU6IHRleHQKICAgICAgZGlzcGxheV9ncm91cDogSW5m\
cmFzdHJ1Y3R1cmUgU2VydmljZXMK"

COPY playbooks /opt/apb/actions
COPY roles /opt/ansible/roles
ADD requirements.yml /opt/apb/actions/requirements.yml
RUN ansible-galaxy install -r /opt/apb/actions/requirements.yml -f
RUN chmod -R g=u /opt/{ansible,apb}
USER apb

ENV BUNDLE_DEBUG=true
