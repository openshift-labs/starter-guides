FROM ansibleplaybookbundle/apb-base:release-1.3

LABEL "com.redhat.apb.spec"=\
"dmVyc2lvbjogJzEuMC4wJwpuYW1lOiBzdGFydGVyLXdvcmtzaG9wLWFwYgpkZXNjcmlwdGlvbjog\
QVBCIHRvIGRlcGxveSByZXF1aXJlZCBpbmZyYSBjb21wb25lbnRzIGZvciB0aGUgRGV2ZWxvcGVy\
IFN0YXJ0ZXIgV29ya3Nob3Agb24gYW4gT3BlblNoaWZ0IGNsdXN0ZXIKYmluZGFibGU6IEZhbHNl\
CmFzeW5jOiBvcHRpb25hbAp0YWdzOgotIHdvcmtzaG9wCm1ldGFkYXRhOgogIGRlcGVuZGVuY2ll\
czogWydkb2NrZXIuaW8vb3Nldmcvd29ya3Nob3BwZXI6bGF0ZXN0JywnZG9ja2VyLmlvL29wZW5z\
aGlmdGRlbW9zL2dvZ3M6MC4xMS4zNCcsJ3F1YXkuaW8vd2t1bGhhbmVrL2V0aGVycGFkOjEuNi41\
JywnZG9ja2VyLmlvL3NvbmF0eXBlL25leHVzMzozLjExLjAnLCAnZG9ja2VyLmlvL3JhZmZhZWxl\
c3BhenpvbGkvb2NwLW9wcy12aWV3OmxhdGVzdCcsICdxdWF5LmlvL29wZW5zaGlmdGxhYnMvd29y\
a3Nob3Atc3Bhd25lcjozLjAuNScsICdxdWF5LmlvL29wZW5zaGlmdGxhYnMvd29ya3Nob3AtdGVy\
bWluYWw6Mi42LjEnXQogIGRpc3BsYXlOYW1lOiAiT3BlblNoaWZ0IERldmVsb3BlciBTdGFydGVy\
IFdvcmtzaG9wIEluc3RhbGxlciIKICBsb25nRGVzY3JpcHRpb246IHwtCiAgICBJbnN0YWxscyB0\
aGUgbGFiIGluc3RydWN0aW9ucyBhbmQgcmVxdWlyZWQgY29tcG9uZW50cwogICAgLSBHb2dzIHNl\
cnZlcgogICAgLSBOZXh1cwogICAgLSBFdGhlcnBhZAogICAgLSBMYWIgR3VpZGVzCiAgICAtIE9D\
UC1PcHNWaWV3IChpbWFnZSBieSBSYWZmYWVsZSBTcGF6em9saSkKICAgIC0gT3BlblNoaWZ0IFdv\
cmtzaG9wIFRlcm1pbmFsCiAgICBmb3IgcnVubmluZyB0aGUgR2V0dGluZyBTdGFydGVkIGRldmVs\
b3Bpbmcgb24gT3BlblNoaWZ0IFdvcmtzaG9wIGh0dHBzOi8vZ2l0aHViLmNvbS9vcGVuc2hpZnQt\
bGFicy9zdGFydGVyLWd1aWRlcwogIGNvbnNvbGUub3BlbnNoaWZ0LmlvL2ljb25DbGFzczogInBm\
aWNvbiBwZmljb24tcHJvY2Vzcy1hdXRvbWF0aW9uIgogIHByb3ZpZGVyRGlzcGxheU5hbWU6ICJS\
ZWQgSGF0LCBJbmMuIgpwbGFuczoKICAtIG5hbWU6IGRlZmF1bHQKICAgIGRlc2NyaXB0aW9uOiBE\
ZXBsb3lzIE9wZW5TaGlmdCBTdGFydGVyIFdvcmtzaG9wIEluZnJhc3RydWN0dXJlCiAgICBmcmVl\
OiBUcnVlCiAgICBtZXRhZGF0YToKICAgICAgZGlzcGxheU5hbWU6IERlZmF1bHQKICAgIHBhcmFt\
ZXRlcnM6CiAgICAtIG5hbWU6IG9wZW5zaGlmdF91c2VyCiAgICAgIHRpdGxlOiBVc2VybmFtZQog\
ICAgICBkZXNjcmlwdGlvbjogVXNlciBpcyByZXF1aXJlZCBmb3IgY3JlYXRpbmcgcHJvamVjdCBh\
ZG1pbiByZXNvdXJjZXMKICAgICAgdHlwZTogc3RyaW5nCiAgICAgIHJlcXVpcmVkOiB0cnVlCiAg\
ICAgIGRpc3BsYXlfdHlwZTogdGV4dAogICAgICBkaXNwbGF5X2dyb3VwOiBPcGVuU2hpZnQgVXNl\
cgogICAgLSBuYW1lOiBvcGVuc2hpZnRfcGFzc3dvcmQKICAgICAgdGl0bGU6IFBhc3N3b3JkCiAg\
ICAgIGRlc2NyaXB0aW9uOiBQYXNzd29yZCBpcyByZXF1aXJlZCBmb3IgY3JlYXRpbmcgcHJvamVj\
dCBhZG1pbiByZXNvdXJjZXMKICAgICAgdHlwZTogc3RyaW5nCiAgICAgIHJlcXVpcmVkOiB0cnVl\
CiAgICAgIGRpc3BsYXlfdHlwZTogcGFzc3dvcmQKICAgICAgZGlzcGxheV9ncm91cDogT3BlblNo\
aWZ0IFVzZXIKICAgIC0gbmFtZTogd29ya3Nob3BfdHlwZQogICAgICB0aXRsZTogV29ya3Nob3Ag\
dHlwZQogICAgICBkZXNjcmlwdGlvbjogVHlwZSBvZiB3b3Jrc2hvcCB0byBkZWxpdmVyIChKYXZh\
LCBQeXRob24sIE5vZGUuanMsIFBIUCkKICAgICAgdHlwZTogZW51bQogICAgICBlbnVtOiBbJ2ph\
dmEnLCAncHl0aG9uJywgJ25vZGUuanMnLCAncGhwJ10KICAgICAgcmVxdWlyZWQ6IHRydWUKICAg\
ICAgZGlzcGxheV90eXBlOiBzZWxlY3QKICAgICAgZGVmYXVsdDogamF2YQogICAgICBkaXNwbGF5\
X2dyb3VwOiBXb3Jrc2hvcAogICAgLSBuYW1lOiB1c2VyX2NvdW50CiAgICAgIHRpdGxlOiBOdW1i\
ZXIgb2YgcGFydGljaXBhbnRzCiAgICAgIGRlc2NyaXB0aW9uOiBOdW1iZXIgb2YgcGFydGljaXBh\
bnRzIGZvciB0aGUgd29ya3Nob3AuIFRoZXJlIHdpbGwgYmUgcHJvdmlzaW9uZWQgaW5mcmFzdHJ1\
Y3R1cmUvcHJvamVjdCBmb3IgZWFjaCBwYXJ0aWNpcGFudAogICAgICB0eXBlOiBudW1iZXIKICAg\
ICAgcmVxdWlyZWQ6IHRydWUKICAgICAgZGlzcGxheV9ncm91cDogV29ya3Nob3AKICAgIC0gbmFt\
ZTogb3BlbnNoaWZ0X3VzZXJfcGFzc3dvcmQKICAgICAgdGl0bGU6IE9wZW5TaGlmdCBVc2VyIFBh\
c3N3b3JkCiAgICAgIGRlc2NyaXB0aW9uOiBUaGUgT3BlblNoaWZ0IHBhc3N3b3JkIGZvciBwYXJ0\
aWNpcGFudHMgdG8gYmUgZGlzcGxheWVkIGluIHRoZSBsYWIgZ3VpZGUgdG8gcGFydGljaXBhbnRz\
CiAgICAgIHR5cGU6IHN0cmluZwogICAgICByZXF1aXJlZDogdHJ1ZQogICAgICBkaXNwbGF5X3R5\
cGU6IHRleHQKICAgICAgZGlzcGxheV9ncm91cDogV29ya3Nob3AKICAgIC0gbmFtZTogaW5mcmFz\
dmNzX2FkbV91c2VyCiAgICAgIHRpdGxlOiBJbmZyYXN0cnVjdHVyZSBTZXJ2aWNlcyBBZG1pbiBV\
c2VyCiAgICAgIGRlc2NyaXB0aW9uOiBBZG1pbiB1c2VyIGZvciBpbmZyYXN0cnVjdHVyZSBzZXJ2\
aWNlcyAoR29ncywgTmV4dXMsIC4uLikKICAgICAgdHlwZTogc3RyaW5nCiAgICAgIGRlZmF1bHQ6\
ICJhZG1pbnVzZXIiCiAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgIGRpc3BsYXlfdHlwZTogdGV4\
dAogICAgICBkaXNwbGF5X2dyb3VwOiBJbmZyYXN0cnVjdHVyZSBTZXJ2aWNlcwogICAgLSBuYW1l\
OiBpbmZyYXN2Y3NfYWRtX3Bhc3N3b3JkCiAgICAgIHRpdGxlOiBJbmZyYXN0cnVjdHVyZSBTZXJ2\
aWNlcyBBZG1pbiBQYXNzd29yZAogICAgICBkZXNjcmlwdGlvbjogQWRtaW4gcGFzc3dvcmQgZm9y\
IGluZnJhc3RydWN0dXJlIHNlcnZpY2VzIChHb2dzLCBOZXh1cywgLi4uKQogICAgICB0eXBlOiBz\
dHJpbmcKICAgICAgZGVmYXVsdDogImFkbWluMTIzIgogICAgICByZXF1aXJlZDogdHJ1ZQogICAg\
ICBkaXNwbGF5X3R5cGU6IHRleHQKICAgICAgZGlzcGxheV9ncm91cDogSW5mcmFzdHJ1Y3R1cmUg\
U2VydmljZXMK"

COPY playbooks /opt/apb/actions
COPY roles /opt/ansible/roles
ADD requirements.yml /opt/apb/actions/requirements.yml
RUN ansible-galaxy install -r /opt/apb/actions/requirements.yml -f
RUN chmod -R g=u /opt/{ansible,apb}
USER apb

ENV BUNDLE_DEBUG=true
