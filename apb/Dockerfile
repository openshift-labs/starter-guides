FROM ansibleplaybookbundle/apb-base:release-1.3

LABEL "com.redhat.apb.spec"=\
"dmVyc2lvbjogJzEuMC4wJwpuYW1lOiBzdGFydGVyLXdvcmtzaG9wLWFwYgpkZXNjcmlwdGlvbjog\
QVBCIHRvIGRlcGxveSByZXF1aXJlZCBpbmZyYSBjb21wb25lbnRzIGZvciB0aGUgRGV2ZWxvcGVy\
IFN0YXJ0ZXIgV29ya3Nob3Agb24gYW4gT3BlblNoaWZ0IGNsdXN0ZXIKYmluZGFibGU6IEZhbHNl\
CmFzeW5jOiBvcHRpb25hbAp0YWdzOgotIHdvcmtzaG9wCm1ldGFkYXRhOgogIGRlcGVuZGVuY2ll\
czogWydkb2NrZXIuaW8vb3Nldmcvd29ya3Nob3BwZXI6bGF0ZXN0JywnZG9ja2VyLmlvL29wZW5z\
aGlmdGRlbW9zL2dvZ3M6MC4xMS4zNCcsJ3F1YXkuaW8vd2t1bGhhbmVrL2V0aGVycGFkOjEuNi41\
JywnZG9ja2VyLmlvL3NvbmF0eXBlL25leHVzMzozLjExLjAnLCAnZG9ja2VyLmlvL3JhZmZhZWxl\
c3BhenpvbGkvb2NwLW9wcy12aWV3OmxhdGVzdCcsICdxdWF5LmlvL29wZW5zaGlmdGxhYnMvd29y\
a3Nob3Atc3Bhd25lcjozLjAuNScsICdxdWF5LmlvL29wZW5zaGlmdGxhYnMvd29ya3Nob3AtdGVy\
bWluYWw6Mi42LjEnXQogIGRpc3BsYXlOYW1lOiAiT3BlblNoaWZ0IERldmVsb3BlciBTdGFydGVy\
IFdvcmtzaG9wIEluc3RhbGxlciIKICBsb25nRGVzY3JpcHRpb246IHwtCiAgICBJbnN0YWxscyB0\
aGUgbGFiIGluc3RydWN0aW9ucyBhbmQgcmVxdWlyZWQgY29tcG9uZW50cwogICAgLSBHb2dzIHNl\
cnZlcgogICAgLSBOZXh1cwogICAgLSBFdGhlcnBhZAogICAgLSBMYWIgR3VpZGVzCiAgICAtIE9D\
UC1PcHNWaWV3IChpbWFnZSBieSBSYWZmYWVsZSBTcGF6em9saSkKICAgIC0gT3BlblNoaWZ0IFdv\
cmtzaG9wIFRlcm1pbmFsCiAgICBmb3IgcnVubmluZyB0aGUgR2V0dGluZyBTdGFydGVkIGRldmVs\
b3Bpbmcgb24gT3BlblNoaWZ0IFdvcmtzaG9wIGh0dHBzOi8vZ2l0aHViLmNvbS9vcGVuc2hpZnQt\
bGFicy9zdGFydGVyLWd1aWRlcwogIGNvbnNvbGUub3BlbnNoaWZ0LmlvL2ljb25DbGFzczogInBm\
aWNvbiBwZmljb24tcHJvY2Vzcy1hdXRvbWF0aW9uIgogIHByb3ZpZGVyRGlzcGxheU5hbWU6ICJS\
ZWQgSGF0LCBJbmMuIgpwbGFuczoKICAtIG5hbWU6IGRlZmF1bHQKICAgIGRlc2NyaXB0aW9uOiBE\
ZXBsb3lzIE9wZW5TaGlmdCBTdGFydGVyIFdvcmtzaG9wIEluZnJhc3RydWN0dXJlCiAgICBmcmVl\
OiBUcnVlCiAgICBtZXRhZGF0YToKICAgICAgZGlzcGxheU5hbWU6IERlZmF1bHQKICAgIHBhcmFt\
ZXRlcnM6CiAgICAtIG5hbWU6IG9wZW5zaGlmdF91c2VyCiAgICAgIHRpdGxlOiBVc2VybmFtZQog\
ICAgICBkZXNjcmlwdGlvbjogVXNlciBpcyByZXF1aXJlZCBmb3IgY3JlYXRpbmcgcHJvamVjdCBh\
ZG1pbiByZXNvdXJjZXMKICAgICAgdHlwZTogc3RyaW5nCiAgICAgIHJlcXVpcmVkOiB0cnVlCiAg\
ICAgIGRpc3BsYXlfdHlwZTogdGV4dAogICAgICBkaXNwbGF5X2dyb3VwOiBPcGVuU2hpZnQgVXNl\
cgogICAgLSBuYW1lOiBvcGVuc2hpZnRfcGFzc3dvcmQKICAgICAgdGl0bGU6IFBhc3N3b3JkCiAg\
ICAgIGRlc2NyaXB0aW9uOiBQYXNzd29yZCBpcyByZXF1aXJlZCBmb3IgY3JlYXRpbmcgcHJvamVj\
dCBhZG1pbiByZXNvdXJjZXMKICAgICAgdHlwZTogc3RyaW5nCiAgICAgIHJlcXVpcmVkOiB0cnVl\
CiAgICAgIGRpc3BsYXlfdHlwZTogcGFzc3dvcmQKICAgICAgZGlzcGxheV9ncm91cDogT3BlblNo\
aWZ0IFVzZXIKICAgIC0gbmFtZTogd29ya3Nob3BfdHlwZQogICAgICB0aXRsZTogV29ya3Nob3Ag\
dHlwZQogICAgICBkZXNjcmlwdGlvbjogVHlwZSBvZiB3b3Jrc2hvcCB0byBkZWxpdmVyIChKYXZh\
LCBQeXRob24sIG5vZGUuanMpCiAgICAgIHR5cGU6IGVudW0KICAgICAgZW51bTogWydqYXZhJywg\
J3B5dGhvbicsICdub2RlLmpzJywgJ3BocCddCiAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgIGRp\
c3BsYXlfdHlwZTogc2VsZWN0CiAgICAgIGRlZmF1bHQ6IGphdmEKICAgICAgZGlzcGxheV9ncm91\
cDogV29ya3Nob3AKICAgIC0gbmFtZTogdXNlcl9jb3VudAogICAgICB0aXRsZTogTnVtYmVyIG9m\
IHBhcnRpY2lwYW50cwogICAgICBkZXNjcmlwdGlvbjogTnVtYmVyIG9mIHBhcnRpY2lwYW50cyBm\
b3IgdGhlIHdvcmtzaG9wLiBUaGVyZSB3aWxsIGJlIHByb3Zpc2lvbmVkIGluZnJhc3RydWN0dXJl\
L3Byb2plY3QgZm9yIGVhY2ggcGFydGljaXBhbnQKICAgICAgdHlwZTogbnVtYmVyCiAgICAgIHJl\
cXVpcmVkOiB0cnVlCiAgICAgIGRpc3BsYXlfZ3JvdXA6IFdvcmtzaG9wCiAgICAtIG5hbWU6IG9w\
ZW5zaGlmdF91c2VyX3Bhc3N3b3JkCiAgICAgIHRpdGxlOiBPcGVuU2hpZnQgVXNlciBQYXNzd29y\
ZAogICAgICBkZXNjcmlwdGlvbjogVGhlIE9wZW5TaGlmdCBwYXNzd29yZCBmb3IgcGFydGljaXBh\
bnRzIHRvIGJlIGRpc3BsYXllZCBpbiB0aGUgbGFiIGd1aWRlIHRvIHBhcnRpY2lwYW50cwogICAg\
ICB0eXBlOiBzdHJpbmcKICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgZGlzcGxheV90eXBlOiB0\
ZXh0CiAgICAgIGRpc3BsYXlfZ3JvdXA6IFdvcmtzaG9wCiAgICAtIG5hbWU6IG9wZW5zaGlmdF9t\
YXN0ZXJfdXJsCiAgICAgIHRpdGxlOiBPcGVuU2hpZnQgTWFzdGVyIFVSTAogICAgICBkZXNjcmlw\
dGlvbjogVGhlIGFkZHJlc3MgdG8gT3BlblNoaWZ0IG1hc3RlciBVUkwgdG8gYmUgZGlzcGxheWVk\
IGluIHRoZSBsYWIgZ3VpZGUgdG8gcGFydGljaXBhbnRzCiAgICAgIHR5cGU6IHN0cmluZwogICAg\
ICByZXF1aXJlZDogdHJ1ZQogICAgICBkaXNwbGF5X3R5cGU6IHRleHQKICAgICAgZGlzcGxheV9n\
cm91cDogTGFiIEd1aWRlCiAgICAtIG5hbWU6IGluZnJhc3Zjc19hZG1fdXNlcgogICAgICB0aXRs\
ZTogSW5mcmFzdHJ1Y3R1cmUgU2VydmljZXMgQWRtaW4gVXNlcgogICAgICBkZXNjcmlwdGlvbjog\
QWRtaW4gdXNlciBmb3IgaW5mcmFzdHJ1Y3R1cmUgc2VydmljZXMgKEdvZ3MsIE5leHVzLCAuLi4p\
CiAgICAgIHR5cGU6IHN0cmluZwogICAgICBkZWZhdWx0OiAiYWRtaW51c2VyIgogICAgICByZXF1\
aXJlZDogdHJ1ZQogICAgICBkaXNwbGF5X3R5cGU6IHRleHQKICAgICAgZGlzcGxheV9ncm91cDog\
SW5mcmFzdHJ1Y3R1cmUgU2VydmljZXMKICAgIC0gbmFtZTogaW5mcmFzdmNzX2FkbV9wYXNzd29y\
ZAogICAgICB0aXRsZTogSW5mcmFzdHJ1Y3R1cmUgU2VydmljZXMgQWRtaW4gUGFzc3dvcmQKICAg\
ICAgZGVzY3JpcHRpb246IEFkbWluIHBhc3N3b3JkIGZvciBpbmZyYXN0cnVjdHVyZSBzZXJ2aWNl\
cyAoR29ncywgTmV4dXMsIC4uLikKICAgICAgdHlwZTogc3RyaW5nCiAgICAgIGRlZmF1bHQ6ICJh\
ZG1pbjEyMyIKICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgZGlzcGxheV90eXBlOiB0ZXh0CiAg\
ICAgIGRpc3BsYXlfZ3JvdXA6IEluZnJhc3RydWN0dXJlIFNlcnZpY2VzCg=="

COPY playbooks /opt/apb/actions
COPY roles /opt/ansible/roles
ADD requirements.yml /opt/apb/actions/requirements.yml
RUN ansible-galaxy install -r /opt/apb/actions/requirements.yml -f
RUN chmod -R g=u /opt/{ansible,apb}
USER apb

ENV BUNDLE_DEBUG=true
